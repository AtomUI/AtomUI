<ResourceDictionary
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:atom="https://atomui.net"
    xmlns:converters="using:AtomUI.Desktop.Controls.Converters"
    x:ClassModifier="internal">
    <converters:NavMenuIsSubMenuOpenConverter x:Key="IsSubMenuOpenConverter" />
    <ControlTheme x:Key="{x:Type atom:NavMenuItem}" TargetType="atom:NavMenuItem">
        <Style Selector="^[Mode=Horizontal]">
            <Setter Property="Template">
                <ControlTemplate>
                    <Panel>
                        <atom:HorizontalNavMenuItemHeader Name="{x:Static atom:NavMenuItemThemeConstants.HeaderPart}"
                                                           Icon="{TemplateBinding Icon}"
                                                           Header="{TemplateBinding Header}"
                                                           HeaderTemplate="{TemplateBinding HeaderTemplate}"
                                                           HasSubMenu="{TemplateBinding HasSubMenu}"
                                                           IsSubMenuOpen="{TemplateBinding IsSubMenuOpen}"
                                                           IsDarkStyle="{TemplateBinding IsDarkStyle}"
                                                           IsEnabled="{TemplateBinding IsEnabled}"
                                                           IsMotionEnabled="{TemplateBinding IsMotionEnabled}"
                                                           IsSelected="{TemplateBinding SelectingItemsControl.IsSelected}"
                                                           IsInSelectedPath="{TemplateBinding IsInSelectedPath}"
                                                           IsTopLevel="{TemplateBinding IsTopLevel}" />
                        <atom:Popup Name="{x:Static atom:NavMenuItemThemeConstants.PopupPart}"
                                    WindowManagerAddShadowHint="False"
                                    IsLightDismissEnabled="False"
                                    IsDetectMouseClickEnabled="False"
                                    ShouldUseOverlayLayer="{TemplateBinding ShouldUseOverlayLayer}"
                                    IsMotionEnabled="{TemplateBinding IsMotionEnabled}">
                            <atom:Popup.IsMotionAwareOpen>
                                <MultiBinding Converter="{StaticResource IsSubMenuOpenConverter}">
                                    <Binding Path="IsSubMenuOpen" RelativeSource="{RelativeSource TemplatedParent}" />
                                    <Binding Path="HasSubMenu" RelativeSource="{RelativeSource TemplatedParent}" />
                                </MultiBinding>
                            </atom:Popup.IsMotionAwareOpen>
                            <Border Name="{x:Static atom:NavMenuItemThemeConstants.PopupFramePart}"
                                    MinWidth="{TemplateBinding EffectivePopupMinWidth}">
                                <atom:ScrollViewer IsScrollChainingEnabled="False"
                                                   IsMotionEnabled="{TemplateBinding IsMotionEnabled}"
                                                   IsLiteMode="{TemplateBinding atom:ScrollViewer.IsLiteMode}"
                                                   AllowAutoHide="{TemplateBinding atom:ScrollViewer.AllowAutoHide}">
                                    <ItemsPresenter
                                        Name="{x:Static atom:NavMenuItemThemeConstants.ItemsPresenterPart}"
                                        ItemsPanel="{TemplateBinding ItemsPanel}"
                                        Grid.IsSharedSizeScope="True"
                                        KeyboardNavigation.TabNavigation="Continue" />
                                </atom:ScrollViewer>
                            </Border>
                        </atom:Popup>
                    </Panel>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="^[Mode=Vertical]">
            <Setter Property="Template">
                <ControlTemplate>
                    <Panel>
                        <atom:VerticalNavMenuItemHeader Name="{x:Static atom:NavMenuItemThemeConstants.HeaderPart}"
                                                         Icon="{TemplateBinding Icon}"
                                                         Header="{TemplateBinding Header}"
                                                         HeaderTemplate="{TemplateBinding HeaderTemplate}"
                                                         HasSubMenu="{TemplateBinding HasSubMenu}"
                                                         IsSubMenuOpen="{TemplateBinding IsSubMenuOpen}"
                                                         IsDarkStyle="{TemplateBinding IsDarkStyle}"
                                                         IsEnabled="{TemplateBinding IsEnabled}"
                                                         IsMotionEnabled="{TemplateBinding IsMotionEnabled}"
                                                         IsSelected="{TemplateBinding SelectingItemsControl.IsSelected}"
                                                         IsInSelectedPath="{TemplateBinding IsInSelectedPath}" />
                        <atom:Popup Name="{x:Static atom:NavMenuItemThemeConstants.PopupPart}"
                                    WindowManagerAddShadowHint="False"
                                    IsLightDismissEnabled="False"
                                    IsDetectMouseClickEnabled="False"
                                    Placement="RightEdgeAlignedTop"
                                    ShouldUseOverlayLayer="{TemplateBinding ShouldUseOverlayLayer}"
                                    IsMotionEnabled="{TemplateBinding IsMotionEnabled}">
                            <atom:Popup.IsMotionAwareOpen>
                                <MultiBinding Converter="{StaticResource IsSubMenuOpenConverter}">
                                    <Binding Path="IsSubMenuOpen" RelativeSource="{RelativeSource TemplatedParent}" />
                                    <Binding Path="HasSubMenu" RelativeSource="{RelativeSource TemplatedParent}" />
                                </MultiBinding>
                            </atom:Popup.IsMotionAwareOpen>

                            <Border Name="{x:Static atom:NavMenuItemThemeConstants.PopupFramePart}">
                                <atom:ScrollViewer IsScrollChainingEnabled="False"
                                                   IsMotionEnabled="{TemplateBinding IsMotionEnabled}"
                                                   IsLiteMode="{TemplateBinding atom:ScrollViewer.IsLiteMode}"
                                                   AllowAutoHide="{TemplateBinding atom:ScrollViewer.AllowAutoHide}">
                                    <ItemsPresenter Name="{x:Static atom:NavMenuItemThemeConstants.ItemsPresenterPart}"
                                                    ItemsPanel="{TemplateBinding ItemsPanel}"
                                                    Grid.IsSharedSizeScope="True" />
                                </atom:ScrollViewer>
                            </Border>
                        </atom:Popup>
                    </Panel>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="^[Mode=Inline]">
            <Setter Property="Template">
                <ControlTemplate>
                    <StackPanel Orientation="Vertical">
                        <atom:InlineNavMenuItemHeader
                            Name="{x:Static atom:NavMenuItemThemeConstants.HeaderPart}"
                            Icon="{TemplateBinding Icon}"
                            Header="{TemplateBinding Header}"
                            HeaderTemplate="{TemplateBinding HeaderTemplate}"
                            Level="{TemplateBinding Level}"
                            HasSubMenu="{TemplateBinding HasSubMenu}"
                            IsSubMenuOpen="{TemplateBinding IsSubMenuOpen}"
                            IsDarkStyle="{TemplateBinding IsDarkStyle}"
                            IsEnabled="{TemplateBinding IsEnabled}"
                            IsMotionEnabled="{TemplateBinding IsMotionEnabled}"
                            IsSelected="{TemplateBinding SelectingItemsControl.IsSelected}"
                            Focusable="{TemplateBinding Focusable}"
                            IsInSelectedPath="{TemplateBinding IsInSelectedPath}" />

                        <atom:LayoutAwareMotionActor
                            Name="{x:Static atom:InlineNavMenuItemThemeConstants.ChildItemsLayoutTransformPart}">
                            <ItemsPresenter Name="ChildItemsPresenter"
                                            Focusable="False"
                                            ItemsPanel="{TemplateBinding ItemsPanel}" />
                        </atom:LayoutAwareMotionActor>
                    </StackPanel>
                </ControlTemplate>
            </Setter>
        </Style>

        <Setter Property="atom:ScrollViewer.IsLiteMode" Value="True" />
        <Setter Property="atom:ScrollViewer.AllowAutoHide" Value="True" />

        <Style Selector="^[Mode=Horizontal],^[Mode=Vertical]">
            <Setter Property="PopupMinWidth"
                    Value="{DynamicResource {x:Static atom:NavMenuTokenKey.MenuPopupMinWidth}}" />

            <Style Selector="^ /template/ atom|Popup#PART_Popup">
                <Setter Property="MarginToAnchor"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.TopLevelItemPopupMarginToAnchor}}" />
                <Setter Property="MaskShadows"
                        Value="{DynamicResource {x:Static atom:PopupHostTokenKey.BoxShadows}}" />
            </Style>

            <Style Selector="^ /template/ Border#PART_PopupFrame">
                <Setter Property="Background"
                        Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorBgElevated}}" />
                <Setter Property="CornerRadius"
                        Value="{DynamicResource {x:Static atom:PopupHostTokenKey.BorderRadius}}" />
                <Setter Property="MinWidth"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.MenuPopupMinWidth}}" />
                <Setter Property="MaxWidth"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.MenuPopupMaxWidth}}" />
                <Setter Property="MaxHeight"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.MenuPopupMaxHeight}}" />
                <Setter Property="Padding"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.MenuPopupContentPadding}}" />
            </Style>
        </Style>

        <Style Selector="^[IsDarkStyle=True]">
            <Style Selector="^ /template/ Border#PART_PopupFrame">
                <Setter Property="Background"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.DarkMenuPopupBg}}" />
            </Style>
        </Style>

        <Style Selector="^[Mode=Horizontal]">
            <Style Selector="^ /template/ atom|Popup#PART_Popup">
                <Setter Property="Placement" Value="RightEdgeAlignedTop" />
            </Style>
        </Style>

        <Style Selector="^[Mode=Horizontal]:toplevel">
            <Setter Property="FontSize" Value="{DynamicResource {x:Static atom:SharedTokenKey.FontSize}}" />
            <Style Selector="^ /template/ atom|Popup#PART_Popup">
                <Setter Property="Placement" Value="Bottom" />
            </Style>
        </Style>

        <Style Selector="^[Mode=Inline]">
            <Setter Property="OpenCloseMotionDuration"
                    Value="{DynamicResource {x:Static atom:SharedTokenKey.MotionDurationSlow}}" />

            <Setter Property="Focusable" Value="False" />
            <Style Selector="^ /template/ ItemsPresenter#ChildItemsPresenter StackPanel">
                <Setter Property="Spacing"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.VerticalItemsPanelSpacing}}" />
            </Style>

            <Style Selector="^ /template/ atom|LayoutAwareMotionActor#PART_ChildItemsLayoutTransform">
                <Setter Property="Margin"
                        Value="{DynamicResource {x:Static atom:NavMenuTokenKey.VerticalChildItemsMargin}}" />
            </Style>
        </Style>

    </ControlTheme>
</ResourceDictionary>